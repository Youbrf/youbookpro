(()=>{"use strict";var e,t={140:(e,t,r)=>{const o=window.wp.blocks,n=window.wp.i18n,s=window.wp.blockEditor,l=window.wp.components,i=window.React;var a=r(338);function c(e){return e.reduce(((e,t)=>{const r=t.category?.name||"Autres";return e[r]||(e[r]=[]),e[r].push(t),e}),{})}function u(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function d(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function p(e,t,r,o,n,s){const l=[];for(let e=r;e<=o-t;e+=n)l.push(e);const i=e.map((e=>{const t=function(e){const[t,r]=e.split(":").map(Number);return 60*t+r}(e.time);return{start:t,end:t+parseInt(e.duration)}})),a=new Date,c=s===a.toISOString().split("T")[0],u=60*a.getHours()+a.getMinutes();return l.filter((e=>{const r=e+t;return!(c&&e<=u||i.some((t=>e<t.end&&r>t.start)))})).map(d)}async function h(e){try{const t=await fetch(`/wp-json/youbookpro/v1/reservations?date=${e}`);return await t.json()}catch(e){return console.error("Erreur lors de la récupération des réservations :",e),[]}}const v=1080,x=window.ReactJSXRuntime,m=function({services:e,selectedServices:t,toggleService:r,error:o,onNextStep:n}){const s=0===e.length&&!o;return(0,x.jsxs)("div",{className:"services-section",children:[s?(0,x.jsx)("p",{children:"Chargement des services..."}):Object.entries(c(e)).map((([e,o])=>(0,x.jsxs)("div",{className:"category-block",children:[(0,x.jsx)("h4",{className:"category-title",children:u(e)}),(0,x.jsx)("table",{className:"category-table desktop-only",children:(0,x.jsx)("tbody",{children:o.map((e=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:u(e.title)}),(0,x.jsxs)("td",{children:[e.price," €"]}),(0,x.jsxs)("td",{children:[e.duration," min"]}),(0,x.jsx)("td",{children:(0,x.jsx)("button",{onClick:()=>r(e),children:t.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})}),(0,x.jsx)("div",{className:"mobile-only",children:o.map((e=>(0,x.jsxs)("div",{className:"mobile-service",children:[(0,x.jsx)("div",{className:"service-title",children:u(e.title)}),(0,x.jsxs)("div",{className:"service-info",children:[(0,x.jsxs)("div",{className:"left-info",children:[(0,x.jsxs)("span",{children:[e.price," €"]})," • ",(0,x.jsxs)("span",{children:[e.duration," min"]})]}),(0,x.jsx)("div",{className:"right-button",children:(0,x.jsx)("button",{onClick:()=>r(e),children:t.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]})]},e.id)))})]},e))),o&&(0,x.jsx)("div",{className:"error-popup",children:o}),t.length>0&&(0,x.jsxs)("div",{className:"next-step-bar centered",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("strong",{children:t.length})," service(s) sélectionné(s) –",(0,x.jsxs)("strong",{children:[" ",t.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,x.jsx)("button",{onClick:n,children:"Choisir un créneau →"})]})]})};function j(e,t){const r=new Date(e);return r.setDate(r.getDate()+t),r}const b=function({totalDuration:e,selectedDate:t,setSelectedDate:r,setAvailableSlots:o}){const[n,s]=(0,i.useState)(new Date),[l,a]=(0,i.useState)([]),[c,u]=(0,i.useState)([]),d=l.some((e=>(e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()})(e)));return(0,i.useEffect)((()=>{(async()=>{try{const t=(new Date).toISOString().split("T")[0],r=await fetch(`/wp-json/youbookpro/v1/reservations/from?from=${t}`),n=await r.json(),s={};n.forEach((e=>{s[e.date]||(s[e.date]=[]),s[e.date].push(e)}));const l=Object.entries(s).filter((([t,r])=>0===p(r,e,600,v,30,r.date).length)).map((([e])=>e)),i=[],a=new Date;for(let e=0;e<30;e++){const t=new Date(a);t.setDate(a.getDate()+e),0===t.getDay()&&i.push(t.toISOString().split("T")[0])}const c=Array.from(new Set([...l,...i]));u(c),c.includes(t)||o(p(await h(t),e,600,v,30,t))}catch(e){console.error("Erreur lors de la récupération des dates désactivées:",e)}})()}),[e]),(0,i.useEffect)((()=>{a(function(e){const t=[];for(let r=0;r<7;r++){const o=new Date(e);o.setDate(o.getDate()+r),t.push(o)}return t}(n))}),[n]),(0,i.useEffect)((()=>{const e=(new Date).toISOString().split("T")[0];r(e)}),[]),(0,x.jsxs)("div",{className:"week-selector",children:[(0,x.jsx)("button",{onClick:()=>s(j(n,-7)),disabled:d,style:{opacity:d?.3:1,cursor:d?"not-allowed":"pointer"},title:d?"Impossible de revenir avant cette semaine":"Semaine précédente",children:"<"}),(0,x.jsx)("div",{className:"week-days",children:l.map((n=>{const s=n.getDate(),l=n.toISOString().split("T")[0],i=t===l,a=0===n.getDay()||c.includes(l);return(0,x.jsx)("button",{disabled:a,className:"day-btn "+(a?"disabled":i?"selected":"normal"),onClick:()=>(async t=>{if(0===t.getDay())return;const n=t.toISOString().split("T")[0];c.includes(n)||(r(n),o(p(await h(n),e,600,v,30,n)))})(n),title:a?"Jour indisponible":"",children:s},l)}))}),(0,x.jsx)("button",{onClick:()=>s(j(n,7)),children:">"})]})},f=({selectedServices:e,totalDuration:t,selectedDate:r,setSelectedDate:o,availableSlots:n,setAvailableSlots:s,selectedSlot:l,setSelectedSlot:i,onNextStep:a,onPrevStep:c,error:u})=>(0,x.jsxs)("div",{className:"slots-section",children:[(0,x.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,x.jsx)("ul",{children:e.map((e=>(0,x.jsxs)("li",{children:[e.title," - ",e.duration," min"]},e.id)))}),(0,x.jsx)("h3",{children:"Choisissez un jour :"}),(0,x.jsx)(b,{setAvailableSlots:s,selectedDate:r,setSelectedDate:o,totalDuration:t}),r&&(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{children:["Créneaux disponibles pour le ",r]}),n.length>0?(0,x.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:n.map((e=>(0,x.jsx)("button",{className:"slot-btn-vertical "+(l===e?"selected":""),onClick:()=>i(e),children:e},e)))}):(0,x.jsx)("p",{children:"Aucun créneau disponible pour cette date."})]}),l&&(0,x.jsxs)("div",{className:"next-step-bar centered",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("strong",{children:"Créneau sélectionné :"})," ",l]}),(0,x.jsx)("button",{onClick:a,children:"Passer à l’étape suivante →"})]}),(0,x.jsx)("button",{onClick:c,children:"← Retour aux services"}),u&&(0,x.jsx)("div",{className:"error-popup",children:u})]}),g=function({selectedDate:e,selectedSlot:t,selectedServices:r,totalDuration:o,onSubmit:n,onPrevStep:s,error:l}){const[a,c]=(0,i.useState)(""),[u,d]=(0,i.useState)(""),[p,h]=(0,i.useState)(""),[v,m]=(0,i.useState)(""),[j,b]=(0,i.useState)(!1),[f,g]=(0,i.useState)(null),[S,y]=(0,i.useState)(!1);return(0,x.jsxs)("div",{className:"confirmation-section",children:[(0,x.jsx)("h3",{children:"Confirmation de la réservation"}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Date :"})," ",e]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Heure :"})," ",t]}),(0,x.jsx)("ul",{children:r.map((e=>(0,x.jsxs)("li",{children:[e.title," – ",e.duration," min"]},e.id)))}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Durée totale :"})," ",o," min"]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Montant total :"})," ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,x.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),g(null),y(!1),!(a&&u&&p&&v?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)?(g(null),1):(g("Veuillez entrer une adresse email valide."),0):(g("Veuillez remplir tous les champs."),0)))return;b(!0);const l={first_name:a,last_name:u,email:p,phone:v,date:e,time:t,services:r.map((e=>e.id)),duration:o};try{await n(l),y(!0)}catch(e){console.error("Erreur de soumission du formulaire:",e),g(e.message||"Une erreur est survenue lors de la réservation."),y(!1)}finally{b(!1)}},children:[" ",(0,x.jsx)("input",{type:"text",placeholder:"Prénom",name:"first_name",value:a,onChange:e=>c(e.target.value),required:!0}),(0,x.jsx)("input",{type:"text",placeholder:"Nom",name:"last_name",value:u,onChange:e=>d(e.target.value),required:!0}),(0,x.jsx)("input",{type:"email",placeholder:"Email",name:"email",value:p,onChange:e=>h(e.target.value),required:!0}),(0,x.jsx)("input",{type:"tel",placeholder:"Téléphone",name:"phone",value:v,onChange:e=>m(e.target.value),required:!0}),j&&(0,x.jsx)("p",{children:"Traitement de votre réservation..."}),f&&(0,x.jsx)("div",{className:"error-popup",children:f}),S&&(0,x.jsx)("div",{className:"success-popup",children:"Réservation effectuée avec succès !"}),l&&!f&&(0,x.jsx)("div",{className:"error-popup",children:l}),(0,x.jsx)("button",{type:"submit",disabled:j||S,children:j?"Confirmation en cours...":S?"Réservé !":"Confirmer la réservation"})]}),(0,x.jsx)("button",{onClick:s,disabled:j,children:"← Retour au créneau"})]})};function S({buttonColor:e,buttonTextColor:t,buttonHoverColor:r,buttonHoverTextColor:o}){const n={"--button-bg-color":e||"#000000","--button-text-color":t||"#ffffff","--button-hover-bg-color":r||"#333333","--button-hover-text-color":o||"#ffffff"},[s,l]=(0,i.useState)(1),[a,c]=(0,i.useState)([]),[u,d]=(0,i.useState)([]),[p,h]=(0,i.useState)(!0),[v,j]=(0,i.useState)(null),[b,S]=(0,i.useState)(null),[y,C]=(0,i.useState)([]),[w,D]=(0,i.useState)([]),[k,N]=(0,i.useState)(null),[T,O]=(0,i.useState)([]),E=a.reduce(((e,t)=>e+parseInt(t.duration)),0);return(0,i.useEffect)((()=>{(async function(){const e=await fetch("/wp-json/youbookpro/v1/services");if(!e.ok)throw new Error("Erreur chargement services");return e.json()})().then(d).catch((e=>{console.error(e),j("Impossible de charger les services.")}))}),[]),(0,i.useEffect)((()=>{if(v){const e=setTimeout((()=>j(null)),5e3);return()=>clearTimeout(e)}}),[v]),(0,x.jsxs)("div",{className:"youbookpro-booking",style:n,children:[1===s&&(0,x.jsx)(m,{services:u,selectedServices:a,toggleService:e=>{c((t=>t.find((t=>t.id===e.id))?(j(null),t.filter((t=>t.id!==e.id))):t.length>=2?(j("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(j(null),[...t,e])))},error:v,onNextStep:()=>{a.length>0?(l(2),j(null)):j("Veuillez sélectionner au moins un service.")}}),2===s&&(0,x.jsx)(f,{selectedServices:a,totalDuration:E,selectedDate:b,setSelectedDate:S,reservations:w,availableSlots:y,setAvailableSlots:C,selectedSlot:k,setSelectedSlot:N,disabledDates:T,setDisabledDatesGlobal:O,onNextStep:()=>{k?(l(3),j(null)):j("Veuillez sélectionner un créneau horaire.")},onPrevStep:()=>{l(1),j(null)},error:v}),3===s&&(0,x.jsx)(g,{selectedDate:b,selectedSlot:k,selectedServices:a,totalDuration:E,onSubmit:async e=>{try{const t=await fetch("/wp-json/youbookpro/v1/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors de la réservation")}const r=await t.json();return l(1),c([]),N(null),S(null),D([]),C([]),r}catch(e){throw console.error("Erreur lors de la réservation (dans BookingBlock) :",e),e}},onPrevStep:()=>{l(2),j(null)},error:v})]})}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,a.H)(e).render((0,x.jsx)(S,{}))}));const y=S,C=JSON.parse('{"UU":"youbookpro/booking"}');(0,o.registerBlockType)(C.UU,{edit:function({attributes:e,setAttributes:t}){const r=(0,s.useBlockProps)(),{buttonColor:o,buttonTextColor:i,buttonHoverColor:a,buttonHoverTextColor:c}=e;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(s.InspectorControls,{children:(0,x.jsxs)(l.PanelBody,{title:(0,n.__)("Bouton","youbookpro"),initialOpen:!0,children:[(0,x.jsx)("p",{children:(0,n.__)("Couleur du bouton","youbookpro")}),(0,x.jsx)(s.ColorPalette,{value:o,onChange:e=>t({buttonColor:e})}),(0,x.jsx)("p",{children:(0,n.__)("Couleur du texte du bouton","youbookpro")}),(0,x.jsx)(s.ColorPalette,{value:i,onChange:e=>t({buttonTextColor:e})}),(0,x.jsx)("p",{children:(0,n.__)("Couleur du bouton au survol","youbookpro")}),(0,x.jsx)(s.ColorPalette,{value:a,onChange:e=>t({buttonHoverColor:e})}),(0,x.jsx)("p",{children:(0,n.__)("Couleur du texte au survol","youbookpro")}),(0,x.jsx)(s.ColorPalette,{value:c,onChange:e=>t({buttonHoverTextColor:e})})]})}),(0,x.jsx)("div",{...r,children:(0,x.jsx)(y,{buttonColor:o,buttonTextColor:i,buttonHoverColor:a,buttonHoverTextColor:c})})]})},save:function(){return null}})},338:(e,t,r)=>{var o=r(795);t.H=o.createRoot,o.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,o),s.exports}o.m=t,e=[],o.O=(t,r,n,s)=>{if(!r){var l=1/0;for(u=0;u<e.length;u++){for(var[r,n,s]=e[u],i=!0,a=0;a<r.length;a++)(!1&s||l>=s)&&Object.keys(o.O).every((e=>o.O[e](r[a])))?r.splice(a--,1):(i=!1,s<l&&(l=s));if(i){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,n,s]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={593:0,749:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var n,s,[l,i,a]=r,c=0;if(l.some((t=>0!==e[t]))){for(n in i)o.o(i,n)&&(o.m[n]=i[n]);if(a)var u=a(o)}for(t&&t(r);c<l.length;c++)s=l[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(u)},r=globalThis.webpackChunkyoubookpro=globalThis.webpackChunkyoubookpro||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=o.O(void 0,[749],(()=>o(140)));n=o.O(n)})();