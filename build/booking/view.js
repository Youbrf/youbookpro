(()=>{"use strict";var e={338:(e,t,r)=>{var n=r(795);t.H=n.createRoot,n.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const r=window.React;var n=function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(338);const s=window.ReactJSXRuntime;function i(){const[e,t]=(0,r.useState)(1),[n,i]=(0,r.useState)([]),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[j,v]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[b,y]=(0,r.useState)([]),[S,k]=(0,r.useState)(null),N=n.reduce(((e,t)=>e+parseInt(t.duration)),0);return(0,r.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/reservations").then((e=>{if(!e.ok)throw new Error("Erreur lors du chargement des réservations");return e.json()})).then((e=>{y(e)})).catch((e=>{console.error("Erreur fetch réservations:",e)}))}),[]),(0,r.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/services").then((e=>{if(!e.ok)throw new Error("Erreur de chargement des services");return e.json()})).then((e=>{c(e),u(!1)})).catch((e=>{console.error("Erreur lors du chargement des services:",e),u(!1)}))}),[]),(0,r.useEffect)((()=>{if(h){const e=setTimeout((()=>p(null)),3e3);return()=>clearTimeout(e)}}),[h]),(0,s.jsxs)("div",{className:"youbookpro-booking",children:[1===e&&(0,s.jsxs)("div",{className:"services-section",children:[d?(0,s.jsx)("p",{children:"Chargement des services..."}):Object.entries(o(l)).map((([e,t])=>(0,s.jsxs)("div",{className:"category-block",children:[(0,s.jsx)("h4",{className:"category-title",children:a(e)}),(0,s.jsxs)("table",{className:"category-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Nom"}),(0,s.jsx)("th",{children:"Prix"}),(0,s.jsx)("th",{children:"Durée"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:t.map((e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:a(e.title)}),(0,s.jsxs)("td",{children:[e.price," €"]}),(0,s.jsxs)("td",{children:[e.duration," min"]}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{onClick:()=>(e=>{i((t=>t.find((t=>t.id===e.id))?(p(null),t.filter((t=>t.id!==e.id))):t.length>=2?(p("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(p(null),[...t,e])))})(e),children:n.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})]})]},e))),h&&(0,s.jsx)("div",{className:"error-popup",children:h}),n.length>0&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:n.length})," service(s) sélectionné(s) –",(0,s.jsxs)("strong",{children:[" ",n.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"Choisir un créneau →"})]})]}),2===e&&(0,s.jsxs)("div",{className:"slots-section",children:[(0,s.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,s.jsx)("ul",{children:n.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," - ",e.duration," min"]},e.id)))}),(0,s.jsx)("input",{type:"date",onChange:e=>{var t;x(e.target.value),t=e.target.value,fetch(`/wp-json/youbookpro/v1/reservations?date=${t}`).then((e=>e.json())).then((e=>{v(e.map((e=>e.time))),y(e),(e=>{const t=N,r=[];for(let s=540;s<=1020-t;s+=15){const i=s,o=s+t;o>1020||e.some((e=>i<e.end&&o>e.start))||r.push((n=i,`${Math.floor(n/60).toString().padStart(2,"0")}:${(n%60).toString().padStart(2,"0")}`))}var n;g(r)})(e.map((e=>{const t=function(e){const[t,r]=e.split(":").map(Number);return 60*t+r}(e.time);return{start:t,end:t+parseInt(e.duration)}})))}))}}),(0,s.jsxs)("div",{className:"available-slots",children:[(0,s.jsxs)("h4",{children:["Créneaux disponibles pour le ",m]}),(0,s.jsx)("ul",{className:"slots-list",children:f.map((e=>(0,s.jsx)("li",{children:(0,s.jsx)("button",{className:S===e?"selected":"",onClick:()=>k(e),children:e})},e)))})]}),S&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Créneau sélectionné :"})," ",S]}),(0,s.jsx)("button",{onClick:()=>t(3),children:"Passer à l’étape suivante →"})]}),(0,s.jsx)("button",{onClick:()=>t(1),children:"Retour"})]}),3===e&&(0,s.jsxs)("div",{className:"confirmation-section",children:[(0,s.jsx)("h3",{children:"Confirmation de la réservation"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date :"})," ",m]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Heure :"})," ",S]}),(0,s.jsx)("ul",{children:n.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," – ",e.duration," min"]},e.id)))}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Durée totale :"})," ",N," min"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Montant total :"})," ",n.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const r=new FormData(e.target),s={first_name:r.get("first_name"),last_name:r.get("last_name"),email:r.get("email"),phone:r.get("phone"),date:m,time:S,services:n.map((e=>e.id)),duration:N};fetch("/wp-json/youbookpro/v1/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{alert("Réservation confirmée !"),t(1),i([]),k(null),x(null)})).catch((e=>{console.error("Erreur lors de la réservation :",e),alert("Erreur lors de la réservation.")}))},children:[(0,s.jsx)("input",{type:"text",placeholder:"Prénom",name:"first_name",required:!0}),(0,s.jsx)("input",{type:"text",placeholder:"Nom",name:"last_name",required:!0}),(0,s.jsx)("input",{type:"email",placeholder:"Email",name:"email",required:!0}),(0,s.jsx)("input",{type:"tel",placeholder:"Téléphone",name:"phone",required:!0}),(0,s.jsx)("button",{type:"submit",children:"Confirmer la réservation"})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"← Retour au créneau"})]})]})}function o(e){return e.reduce(((e,t)=>{const r=t.category?.name||"Autres";return e[r]||(e[r]=[]),e[r].push(t),e}),{})}function a(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,n.H)(e).render((0,s.jsx)(i,{}))}))})();