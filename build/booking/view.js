(()=>{"use strict";var e={338:(e,t,n)=>{var r=n(795);t.H=r.createRoot,r.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const n=window.React;var r=function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(338);const s=window.ReactJSXRuntime;function i(){const[e,t]=(0,n.useState)(1),[r,i]=(0,n.useState)([]),[l,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(!0),[p,x]=(0,n.useState)(null),[m,j]=(0,n.useState)(null),[v,f]=(0,n.useState)([]),[g,b]=(0,n.useState)([]),[S,y]=(0,n.useState)([]),[D,w]=(0,n.useState)(null),k=r.reduce(((e,t)=>e+parseInt(t.duration)),0);return(0,n.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/reservations").then((e=>{if(!e.ok)throw new Error("Erreur lors du chargement des réservations");return e.json()})).then((e=>{y(e)})).catch((e=>{console.error("Erreur fetch réservations:",e)}))}),[]),(0,n.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/services").then((e=>{if(!e.ok)throw new Error("Erreur de chargement des services");return e.json()})).then((e=>{d(e),h(!1)})).catch((e=>{console.error("Erreur lors du chargement des services:",e),h(!1)}))}),[]),(0,n.useEffect)((()=>{if(p){const e=setTimeout((()=>x(null)),3e3);return()=>clearTimeout(e)}}),[p]),(0,s.jsxs)("div",{className:"youbookpro-booking",children:[1===e&&(0,s.jsxs)("div",{className:"services-section",children:[u?(0,s.jsx)("p",{children:"Chargement des services..."}):Object.entries(o(l)).map((([e,t])=>(0,s.jsxs)("div",{className:"category-block",children:[(0,s.jsx)("h4",{className:"category-title",children:a(e)}),(0,s.jsxs)("table",{className:"category-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Nom"}),(0,s.jsx)("th",{children:"Prix"}),(0,s.jsx)("th",{children:"Durée"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:t.map((e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:a(e.title)}),(0,s.jsxs)("td",{children:[e.price," €"]}),(0,s.jsxs)("td",{children:[e.duration," min"]}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{onClick:()=>(e=>{i((t=>t.find((t=>t.id===e.id))?(x(null),t.filter((t=>t.id!==e.id))):t.length>=2?(x("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(x(null),[...t,e])))})(e),children:r.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})]})]},e))),p&&(0,s.jsx)("div",{className:"error-popup",children:p}),r.length>0&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:r.length})," service(s) sélectionné(s) –",(0,s.jsxs)("strong",{children:[" ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"Choisir un créneau →"})]})]}),2===e&&(0,s.jsxs)("div",{className:"slots-section",children:[(0,s.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,s.jsx)("ul",{children:r.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," - ",e.duration," min"]},e.id)))}),(0,s.jsx)("h3",{children:"Choisissez un jour :"}),(0,s.jsx)(c,{onDateSelected:e=>{j(e),fetch(`/wp-json/youbookpro/v1/reservations?date=${e}`).then((e=>e.json())).then((e=>{f(e.map((e=>e.time))),y(e),(e=>{const t=k,n=[];for(let s=600;s<=1080-t;s+=15){const i=s,o=s+t;o>1080||e.some((e=>i<e.end&&o>e.start))||n.push((r=i,`${Math.floor(r/60).toString().padStart(2,"0")}:${(r%60).toString().padStart(2,"0")}`))}var r;b(n)})(e.map((e=>{const t=function(e){const[t,n]=e.split(":").map(Number);return 60*t+n}(e.time);return{start:t,end:t+parseInt(e.duration)}})))}))}}),m&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{children:["Créneaux disponibles pour le ",m]}),g.length>0?(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:g.map((e=>(0,s.jsx)("button",{className:"slot-btn-vertical "+(D===e?"selected":""),onClick:()=>w(e),children:e},e)))}):(0,s.jsx)("p",{children:"Aucun créneau disponible."})]}),D&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Créneau sélectionné :"})," ",D]}),(0,s.jsx)("button",{onClick:()=>t(3),children:"Passer à l’étape suivante →"})]}),(0,s.jsx)("button",{onClick:()=>t(1),children:"Retour"})]}),3===e&&(0,s.jsxs)("div",{className:"confirmation-section",children:[(0,s.jsx)("h3",{children:"Confirmation de la réservation"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date :"})," ",m]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Heure :"})," ",D]}),(0,s.jsx)("ul",{children:r.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," – ",e.duration," min"]},e.id)))}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Durée totale :"})," ",k," min"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Montant total :"})," ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n=new FormData(e.target),s={first_name:n.get("first_name"),last_name:n.get("last_name"),email:n.get("email"),phone:n.get("phone"),date:m,time:D,services:r.map((e=>e.id)),duration:k};fetch("/wp-json/youbookpro/v1/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{alert("Réservation confirmée !"),t(1),i([]),w(null),j(null)})).catch((e=>{console.error("Erreur lors de la réservation :",e),alert("Erreur lors de la réservation.")}))},children:[(0,s.jsx)("input",{type:"text",placeholder:"Prénom",name:"first_name",required:!0}),(0,s.jsx)("input",{type:"text",placeholder:"Nom",name:"last_name",required:!0}),(0,s.jsx)("input",{type:"email",placeholder:"Email",name:"email",required:!0}),(0,s.jsx)("input",{type:"tel",placeholder:"Téléphone",name:"phone",required:!0}),(0,s.jsx)("button",{type:"submit",children:"Confirmer la réservation"})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"← Retour au créneau"})]})]})}function o(e){return e.reduce(((e,t)=>{const n=t.category?.name||"Autres";return e[n]||(e[n]=[]),e[n].push(t),e}),{})}function a(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function c({onDateSelected:e}){const[t,r]=(0,n.useState)(function(e){const t=new Date(e),n=t.getDay(),r=t.getDate()-n+(0===n?-6:1);return new Date(t.setDate(r))}(new Date)),[i,o]=(0,n.useState)(new Date),[a,c]=(0,n.useState)([]);return(0,n.useEffect)((()=>{c(function(e){const t=[];for(let n=0;n<7;n++){const r=new Date(e);r.setDate(r.getDate()+n),t.push(r)}return t}(t))}),[t]),(0,n.useEffect)((()=>{const t=i.toISOString().split("T")[0];e(t)}),[]),(0,s.jsxs)("div",{className:"week-selector",children:[(0,s.jsx)("button",{onClick:()=>r(l(t,-7)),children:"<"}),(0,s.jsx)("div",{className:"week-days",children:a.map((t=>{const n=t.getDate(),r=i?.toDateString()===t.toDateString(),a=0===t.getDay();return(0,s.jsx)("button",{className:`day-btn ${r?"selected":""} ${a?"disabled":""}`,onClick:()=>(t=>{if(0===t.getDay())return;o(t);const n=t.toISOString().split("T")[0];e(n)})(t),disabled:a,title:a?"Fermé le dimanche":"",children:n},t.toISOString())}))}),(0,s.jsx)("button",{onClick:()=>r(l(t,7)),children:">"})]})}function l(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,r.H)(e).render((0,s.jsx)(i,{}))}))})();