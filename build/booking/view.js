(()=>{"use strict";var e={338:(e,t,n)=>{var r=n(795);t.H=r.createRoot,r.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const n=window.React;var r=function n(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}(338);const s=window.ReactJSXRuntime;function o(){const[e,t]=(0,n.useState)(1),[r,o]=(0,n.useState)([]),[u,h]=(0,n.useState)([]),[p,m]=(0,n.useState)(!0),[x,j]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),[g,b]=(0,n.useState)([]),[S,D]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[k,C]=(0,n.useState)(null),E=r.reduce(((e,t)=>e+parseInt(t.duration)),0),[N,T]=(0,n.useState)([]),I=e=>{const t=E,n=[];for(let r=600;r<=1080-t;r+=30){const s=r,o=r+t;o>1080||(e.some((e=>s<e.end&&o>e.start))||n.push(l(s)))}D(n)};return(0,n.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/reservations").then((e=>{if(!e.ok)throw new Error("Erreur lors du chargement des réservations");return e.json()})).then((e=>{w(e)})).catch((e=>{console.error("Erreur fetch réservations:",e)}))}),[]),(0,n.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/services").then((e=>{if(!e.ok)throw new Error("Erreur de chargement des services");return e.json()})).then((e=>{h(e),m(!1)})).catch((e=>{console.error("Erreur lors du chargement des services:",e),m(!1)}))}),[]),(0,n.useEffect)((()=>{if(x){const e=setTimeout((()=>j(null)),3e3);return()=>clearTimeout(e)}}),[x]),(0,s.jsxs)("div",{className:"youbookpro-booking",children:[1===e&&(0,s.jsxs)("div",{className:"services-section",children:[p?(0,s.jsx)("p",{children:"Chargement des services..."}):Object.entries(i(u)).map((([e,t])=>(0,s.jsxs)("div",{className:"category-block",children:[(0,s.jsx)("h4",{className:"category-title",children:a(e)}),(0,s.jsxs)("table",{className:"category-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Nom"}),(0,s.jsx)("th",{children:"Prix"}),(0,s.jsx)("th",{children:"Durée"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:t.map((e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:a(e.title)}),(0,s.jsxs)("td",{children:[e.price," €"]}),(0,s.jsxs)("td",{children:[e.duration," min"]}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{onClick:()=>(e=>{o((t=>t.find((t=>t.id===e.id))?(j(null),t.filter((t=>t.id!==e.id))):t.length>=2?(j("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(j(null),[...t,e])))})(e),children:r.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})]})]},e))),x&&(0,s.jsx)("div",{className:"error-popup",children:x}),r.length>0&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:r.length})," service(s) sélectionné(s) –",(0,s.jsxs)("strong",{children:[" ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"Choisir un créneau →"})]})]}),2===e&&(0,s.jsxs)("div",{className:"slots-section",children:[(0,s.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,s.jsx)("ul",{children:r.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," - ",e.duration," min"]},e.id)))}),(0,s.jsx)("h3",{children:"Choisissez un jour :"}),(0,s.jsx)(d,{onDisabledDatesFetched:e=>{console.log("Dates désactivées :",e),T(e)},onDateSelected:e=>{v(e),(e=>{if(N.includes(e))return console.log("Date désactivée, pas de fetch :",e),b([]),w([]),void I([]);console.log("Date activé, fetch :",e),fetch(`/wp-json/youbookpro/v1/reservations?date=${e}`).then((e=>e.json())).then((e=>{b(e.map((e=>e.time))),w(e);const t=e.map((e=>{const t=c(e.time);return{start:t,end:t+parseInt(e.duration)}}));I(t)}))})(e)},totalDuration:E}),f&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{children:["Créneaux disponibles pour le ",f]}),S.length>0?(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:S.map((e=>(0,s.jsx)("button",{className:"slot-btn-vertical "+(k===e?"selected":""),onClick:()=>C(e),children:e},e)))}):(0,s.jsx)("p",{children:"Aucun créneau disponible."})]}),k&&(0,s.jsxs)("div",{className:"next-step-bar centered",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Créneau sélectionné :"})," ",k]}),(0,s.jsx)("button",{onClick:()=>t(3),children:"Passer à l’étape suivante →"})]}),(0,s.jsx)("button",{onClick:()=>t(1),children:"Retour"})]}),3===e&&(0,s.jsxs)("div",{className:"confirmation-section",children:[(0,s.jsx)("h3",{children:"Confirmation de la réservation"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date :"})," ",f]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Heure :"})," ",k]}),(0,s.jsx)("ul",{children:r.map((e=>(0,s.jsxs)("li",{children:[a(e.title)," – ",e.duration," min"]},e.id)))}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Durée totale :"})," ",E," min"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Montant total :"})," ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n=new FormData(e.target),s={first_name:n.get("first_name"),last_name:n.get("last_name"),email:n.get("email"),phone:n.get("phone"),date:f,time:k,services:r.map((e=>e.id)),duration:E};fetch("/wp-json/youbookpro/v1/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{alert("Réservation confirmée !"),t(1),o([]),C(null),v(null)})).catch((e=>{console.error("Erreur lors de la réservation :",e),alert("Erreur lors de la réservation.")}))},children:[(0,s.jsx)("input",{type:"text",placeholder:"Prénom",name:"first_name",required:!0}),(0,s.jsx)("input",{type:"text",placeholder:"Nom",name:"last_name",required:!0}),(0,s.jsx)("input",{type:"email",placeholder:"Email",name:"email",required:!0}),(0,s.jsx)("input",{type:"tel",placeholder:"Téléphone",name:"phone",required:!0}),(0,s.jsx)("button",{type:"submit",children:"Confirmer la réservation"})]}),(0,s.jsx)("button",{onClick:()=>t(2),children:"← Retour au créneau"})]})]})}function i(e){return e.reduce(((e,t)=>{const n=t.category?.name||"Autres";return e[n]||(e[n]=[]),e[n].push(t),e}),{})}function a(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function c(e){const[t,n]=e.split(":").map(Number);return 60*t+n}function l(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function d({onDateSelected:e,totalDuration:t,onDisabledDatesFetched:r}){const[o,i]=(0,n.useState)(new Date),[a,d]=(0,n.useState)(new Date),[h,p]=(0,n.useState)([]),[m,x]=(0,n.useState)([]),j=h.some((e=>(e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()})(e)));return(0,n.useEffect)((()=>{(async()=>{try{const e=[],n=(new Date).toISOString().split("T")[0],s=await fetch(`/wp-json/youbookpro/v1/reservations/from?from=${n}`),o=await s.json(),i=await Promise.all(o.map((async e=>{const n=e.date,r=await function(e,t){return fetch(`/wp-json/youbookpro/v1/reservations?date=${e}`).then((e=>e.json())).then((e=>{const n=e.map((e=>{const t=c(e.time);return{start:t,end:t+parseInt(e.duration)}})),r=t,s=[];for(let e=600;e<=1080-r;e+=30){const t=e,o=e+r;n.some((e=>t<e.end&&o>e.start))||s.push(l(t))}return s}))}(n,t);return 0===r.length?n:null})));for(let t=0;t<362;t++){const n=new Date;n.setDate(n.getDate()-t);const r=n.toISOString().split("T")[0];e.push(r)}const a=i.filter((e=>null!==e));x([...new Set([...a,...e])]),r?.([...new Set([...a,...e])])}catch(e){console.error("Erreur lors de la récupération des dates désactivées:",e)}})()}),[]),(0,n.useEffect)((()=>{p(function(e){const t=[];for(let n=0;n<7;n++){const r=new Date(e);r.setDate(r.getDate()+n),t.push(r)}return t}(o))}),[o]),(0,n.useEffect)((()=>{const t=a.toISOString().split("T")[0];e(t)}),[]),(0,s.jsxs)("div",{className:"week-selector",children:[(0,s.jsx)("button",{onClick:()=>i(u(o,-7)),disabled:j,style:{opacity:j?.3:1,cursor:j?"not-allowed":"pointer"},title:j?"Impossible de revenir avant cette semaine":"Semaine précédente",children:"<"}),(0,s.jsx)("div",{className:"week-days",children:h.map((t=>{const n=t.getDate(),r=a?.toDateString()===t.toDateString(),o=0===t.getDay(),i=t.toISOString().split("T")[0],c=o||m.includes(i);return(0,s.jsx)("button",{disabled:c,className:`day-btn ${r?"selected":""} ${c?"disabled":""}`,onClick:()=>(t=>{if(0===t.getDay())return;d(t);const n=t.toISOString().split("T")[0];e(n)})(t),title:c?"Jour indisponible":"",children:n},i)}))}),(0,s.jsx)("button",{onClick:()=>i(u(o,7)),children:">"})]})}function u(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,r.H)(e).render((0,s.jsx)(o,{}))}))})();