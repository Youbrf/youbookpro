(()=>{"use strict";var e={338:(e,t,r)=>{var s=r(795);t.H=s.createRoot,s.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const r=window.React;var s=function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}(338);const n=window.ReactJSXRuntime;function i(){const[e,t]=(0,r.useState)(1),[s,i]=(0,r.useState)([]),[l,a]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(null),[j,p]=(0,r.useState)(null),[m,v]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[b,k]=(0,r.useState)([]),[S,N]=(0,r.useState)(null),C=s.reduce(((e,t)=>e+parseInt(t.duration)),0);return(0,r.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/reservations").then((e=>{if(!e.ok)throw new Error("Erreur lors du chargement des réservations");return e.json()})).then((e=>{k(e)})).catch((e=>{console.error("Erreur fetch réservations:",e)}))}),[]),(0,r.useEffect)((()=>{fetch("/wp-json/youbookpro/v1/services").then((e=>{if(!e.ok)throw new Error("Erreur de chargement des services");return e.json()})).then((e=>{a(e),u(!1)})).catch((e=>{console.error("Erreur lors du chargement des services:",e),u(!1)}))}),[]),(0,r.useEffect)((()=>{if(h){const e=setTimeout((()=>x(null)),3e3);return()=>clearTimeout(e)}}),[h]),(0,n.jsxs)("div",{className:"youbookpro-booking",children:[1===e&&(0,n.jsxs)("div",{className:"services-section",children:[d?(0,n.jsx)("p",{children:"Chargement des services..."}):Object.entries(o(l)).map((([e,t])=>(0,n.jsxs)("div",{className:"category-block",children:[(0,n.jsx)("h4",{className:"category-title",children:c(e)}),(0,n.jsxs)("table",{className:"category-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Nom"}),(0,n.jsx)("th",{children:"Prix"}),(0,n.jsx)("th",{children:"Durée"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:t.map((e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:c(e.title)}),(0,n.jsxs)("td",{children:[e.price," €"]}),(0,n.jsxs)("td",{children:[e.duration," min"]}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{onClick:()=>(e=>{i((t=>t.find((t=>t.id===e.id))?(x(null),t.filter((t=>t.id!==e.id))):t.length>=2?(x("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(x(null),[...t,e])))})(e),children:s.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})]})]},e))),h&&(0,n.jsx)("div",{className:"error-popup",children:h}),s.length>0&&(0,n.jsxs)("div",{className:"next-step-bar centered",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:s.length})," service(s) sélectionné(s) –",(0,n.jsxs)("strong",{children:[" ",s.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,n.jsx)("button",{onClick:()=>t(2),children:"Choisir un créneau →"})]})]}),2===e&&(0,n.jsxs)("div",{className:"slots-section",children:[(0,n.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,n.jsx)("ul",{children:s.map((e=>(0,n.jsxs)("li",{children:[c(e.title)," - ",e.duration," min"]},e.id)))}),(0,n.jsx)("input",{type:"date",onChange:e=>{var t;p(e.target.value),t=e.target.value,fetch(`/wp-json/youbookpro/v1/reservations?date=${t}`).then((e=>e.json())).then((e=>{v(e.map((e=>e.time))),k(e),(e=>{const t=C,r=[];for(let n=540;n<=1020-t;n+=15){const i=n,o=n+t;o>1020||e.some((e=>i<e.end&&o>e.start))||r.push((s=i,`${Math.floor(s/60).toString().padStart(2,"0")}:${(s%60).toString().padStart(2,"0")}`))}var s;g(r)})(e.map((e=>{const t=function(e){const[t,r]=e.split(":").map(Number);return 60*t+r}(e.time);return{start:t,end:t+parseInt(e.duration)}})))}))}}),(0,n.jsxs)("div",{className:"available-slots",children:[(0,n.jsxs)("h4",{children:["Créneaux disponibles pour le ",j]}),(0,n.jsx)("ul",{className:"slots-list",children:f.map((e=>(0,n.jsx)("li",{children:(0,n.jsx)("button",{className:S===e?"selected":"",onClick:()=>N(e),children:e})},e)))})]}),S&&(0,n.jsxs)("div",{className:"next-step-bar centered",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Créneau sélectionné :"})," ",S]}),(0,n.jsx)("button",{onClick:()=>t(3),children:"Passer à l’étape suivante →"})]}),(0,n.jsx)("button",{onClick:()=>t(1),children:"Retour"})]}),3===e&&(0,n.jsxs)("div",{className:"confirmation-section",children:[(0,n.jsx)("h3",{children:"Confirmation de la réservation"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Date :"})," ",j]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Heure :"})," ",S]}),(0,n.jsx)("ul",{children:s.map((e=>(0,n.jsxs)("li",{children:[c(e.title)," – ",e.duration," min"]},e.id)))}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Durée totale :"})," ",C," min"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Montant total :"})," ",s.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,n.jsx)("button",{onClick:()=>t(2),children:"← Retour au créneau"})]})]})}function o(e){return e.reduce(((e,t)=>{const r=t.category?.name||"Autres";return e[r]||(e[r]=[]),e[r].push(t),e}),{})}function c(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,s.H)(e).render((0,n.jsx)(i,{}))}))})();