(()=>{"use strict";var e={338:(e,t,s)=>{var r=s(795);t.H=r.createRoot,r.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const s=window.React;var r=function s(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}(338);function n(e){return e.reduce(((e,t)=>{const s=t.category?.name||"Autres";return e[s]||(e[s]=[]),e[s].push(t),e}),{})}function o(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function a(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}function i(e,t,s,r,n,o){const i=[];for(let e=s;e<=r-t;e+=n)i.push(e);const l=e.map((e=>{const t=function(e){const[t,s]=e.split(":").map(Number);return 60*t+s}(e.time);return{start:t,end:t+parseInt(e.duration)}})),c=new Date,d=o===c.toISOString().split("T")[0],u=60*c.getHours()+c.getMinutes();return i.filter((e=>{const s=e+t;return!(d&&e<=u||l.some((t=>e<t.end&&s>t.start)))})).map(a)}async function l(e){try{const t=await fetch(`/wp-json/youbookpro/v1/reservations?date=${e}`);return await t.json()}catch(e){return console.error("Erreur lors de la récupération des réservations :",e),[]}}const c=1080,d=window.ReactJSXRuntime,u=function({services:e,selectedServices:t,toggleService:s,error:r,onNextStep:a}){const i=0===e.length&&!r;return(0,d.jsxs)("div",{className:"services-section",children:[i?(0,d.jsx)("p",{children:"Chargement des services..."}):Object.entries(n(e)).map((([e,r])=>(0,d.jsxs)("div",{className:"category-block",children:[(0,d.jsx)("h4",{className:"category-title",children:o(e)}),(0,d.jsxs)("table",{className:"category-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"Nom"}),(0,d.jsx)("th",{children:"Prix"}),(0,d.jsx)("th",{children:"Durée"}),(0,d.jsx)("th",{})]})}),(0,d.jsx)("tbody",{children:r.map((e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:o(e.title)}),(0,d.jsxs)("td",{children:[e.price," €"]}),(0,d.jsxs)("td",{children:[e.duration," min"]}),(0,d.jsx)("td",{children:(0,d.jsx)("button",{onClick:()=>s(e),children:t.find((t=>t.id===e.id))?"Retirer":"Sélectionner"})})]},e.id)))})]})]},e))),r&&(0,d.jsx)("div",{className:"error-popup",children:r}),t.length>0&&(0,d.jsxs)("div",{className:"next-step-bar centered",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:t.length})," service(s) sélectionné(s) –",(0,d.jsxs)("strong",{children:[" ",t.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]})]}),(0,d.jsx)("button",{onClick:a,children:"Choisir un créneau →"})]})]})};function h(e,t){const s=new Date(e);return s.setDate(s.getDate()+t),s}const p=function({totalDuration:e,selectedDate:t,setSelectedDate:r,setAvailableSlots:n}){const[o,a]=(0,s.useState)(new Date),[u,p]=(0,s.useState)([]),[m,x]=(0,s.useState)([]),v=u.some((e=>(e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()})(e)));return(0,s.useEffect)((()=>{(async()=>{try{const t=(new Date).toISOString().split("T")[0],s=await fetch(`/wp-json/youbookpro/v1/reservations/from?from=${t}`),r=await s.json(),o={};r.forEach((e=>{o[e.date]||(o[e.date]=[]),o[e.date].push(e)}));const a=Object.entries(o).filter((([t,s])=>0===i(s,e,600,c,30,s.date).length)).map((([e])=>e)),d=[],u=new Date;for(let e=0;e<30;e++){const t=new Date(u);t.setDate(u.getDate()+e),0===t.getDay()&&d.push(t.toISOString().split("T")[0])}const h=Array.from(new Set([...a,...d]));x(h),h.includes(t)||n(i(await l(t),e,600,c,30,t))}catch(e){console.error("Erreur lors de la récupération des dates désactivées:",e)}})()}),[e]),(0,s.useEffect)((()=>{p(function(e){const t=[];for(let s=0;s<7;s++){const r=new Date(e);r.setDate(r.getDate()+s),t.push(r)}return t}(o))}),[o]),(0,s.useEffect)((()=>{const e=(new Date).toISOString().split("T")[0];r(e)}),[]),(0,d.jsxs)("div",{className:"week-selector",children:[(0,d.jsx)("button",{onClick:()=>a(h(o,-7)),disabled:v,style:{opacity:v?.3:1,cursor:v?"not-allowed":"pointer"},title:v?"Impossible de revenir avant cette semaine":"Semaine précédente",children:"<"}),(0,d.jsx)("div",{className:"week-days",children:u.map((s=>{const o=s.getDate(),a=s.toISOString().split("T")[0],u=t===a,h=0===s.getDay()||m.includes(a);return(0,d.jsx)("button",{disabled:h,className:"day-btn "+(h?"disabled":u?"selected":"normal"),onClick:()=>(async t=>{if(0===t.getDay())return;const s=t.toISOString().split("T")[0];m.includes(s)||(r(s),n(i(await l(s),e,600,c,30,s)))})(s),title:h?"Jour indisponible":"",children:o},a)}))}),(0,d.jsx)("button",{onClick:()=>a(h(o,7)),children:">"})]})},m=({selectedServices:e,totalDuration:t,selectedDate:s,setSelectedDate:r,availableSlots:n,setAvailableSlots:o,selectedSlot:a,setSelectedSlot:i,onNextStep:l,onPrevStep:c,error:u})=>(0,d.jsxs)("div",{className:"slots-section",children:[(0,d.jsx)("h3",{children:"Créneaux disponibles pour :"}),(0,d.jsx)("ul",{children:e.map((e=>(0,d.jsxs)("li",{children:[e.title," - ",e.duration," min"]},e.id)))}),(0,d.jsx)("h3",{children:"Choisissez un jour :"}),(0,d.jsx)(p,{setAvailableSlots:o,selectedDate:s,setSelectedDate:r,totalDuration:t}),s&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("h4",{children:["Créneaux disponibles pour le ",s]}),n.length>0?(0,d.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:n.map((e=>(0,d.jsx)("button",{className:"slot-btn-vertical "+(a===e?"selected":""),onClick:()=>i(e),children:e},e)))}):(0,d.jsx)("p",{children:"Aucun créneau disponible pour cette date."})]}),a&&(0,d.jsxs)("div",{className:"next-step-bar centered",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Créneau sélectionné :"})," ",a]}),(0,d.jsx)("button",{onClick:l,children:"Passer à l’étape suivante →"})]}),(0,d.jsx)("button",{onClick:c,children:"← Retour aux services"}),u&&(0,d.jsx)("div",{className:"error-popup",children:u})]}),x=function({selectedDate:e,selectedSlot:t,selectedServices:r,totalDuration:n,onSubmit:o,onPrevStep:a,error:i}){const[l,c]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),[x,v]=(0,s.useState)(""),[j,S]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[b,D]=(0,s.useState)(!1);return(0,d.jsxs)("div",{className:"confirmation-section",children:[(0,d.jsx)("h3",{children:"Confirmation de la réservation"}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Date :"})," ",e]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Heure :"})," ",t]}),(0,d.jsx)("ul",{children:r.map((e=>(0,d.jsxs)("li",{children:[e.title," – ",e.duration," min"]},e.id)))}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Durée totale :"})," ",n," min"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Montant total :"})," ",r.reduce(((e,t)=>e+parseFloat(t.price)),0)," €"]}),(0,d.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),f(null),D(!1),!(l&&u&&p&&x?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)?(f(null),1):(f("Veuillez entrer une adresse email valide."),0):(f("Veuillez remplir tous les champs."),0)))return;S(!0);const a={first_name:l,last_name:u,email:p,phone:x,date:e,time:t,services:r.map((e=>e.id)),duration:n};try{await o(a),D(!0)}catch(e){console.error("Erreur de soumission du formulaire:",e),f(e.message||"Une erreur est survenue lors de la réservation."),D(!1)}finally{S(!1)}},children:[" ",(0,d.jsx)("input",{type:"text",placeholder:"Prénom",name:"first_name",value:l,onChange:e=>c(e.target.value),required:!0}),(0,d.jsx)("input",{type:"text",placeholder:"Nom",name:"last_name",value:u,onChange:e=>h(e.target.value),required:!0}),(0,d.jsx)("input",{type:"email",placeholder:"Email",name:"email",value:p,onChange:e=>m(e.target.value),required:!0}),(0,d.jsx)("input",{type:"tel",placeholder:"Téléphone",name:"phone",value:x,onChange:e=>v(e.target.value),required:!0}),j&&(0,d.jsx)("p",{children:"Traitement de votre réservation..."}),g&&(0,d.jsx)("div",{className:"error-popup",children:g}),b&&(0,d.jsx)("div",{className:"success-popup",children:"Réservation effectuée avec succès !"}),i&&!g&&(0,d.jsx)("div",{className:"error-popup",children:i}),(0,d.jsx)("button",{type:"submit",disabled:j||b,children:j?"Confirmation en cours...":b?"Réservé !":"Confirmer la réservation"})]}),(0,d.jsx)("button",{onClick:a,disabled:j,children:"← Retour au créneau"})]})};function v(){const[e,t]=(0,s.useState)(1),[r,n]=(0,s.useState)([]),[o,a]=(0,s.useState)([]),[i,l]=(0,s.useState)(!0),[c,h]=(0,s.useState)(null),[p,v]=(0,s.useState)(null),[j,S]=(0,s.useState)([]),[g,f]=(0,s.useState)([]),[b,D]=(0,s.useState)(null),[y,w]=(0,s.useState)([]),k=r.reduce(((e,t)=>e+parseInt(t.duration)),0);return(0,s.useEffect)((()=>{(async function(){const e=await fetch("/wp-json/youbookpro/v1/services");if(!e.ok)throw new Error("Erreur chargement services");return e.json()})().then(a).catch((e=>{console.error(e),h("Impossible de charger les services.")}))}),[]),(0,s.useEffect)((()=>{if(c){const e=setTimeout((()=>h(null)),5e3);return()=>clearTimeout(e)}}),[c]),(0,d.jsxs)("div",{className:"youbookpro-booking",children:[1===e&&(0,d.jsx)(u,{services:o,selectedServices:r,toggleService:e=>{n((t=>t.find((t=>t.id===e.id))?(h(null),t.filter((t=>t.id!==e.id))):t.length>=2?(h("Vous pouvez sélectionner jusqu'à 2 services maximum."),t):(h(null),[...t,e])))},error:c,onNextStep:()=>{r.length>0?(t(2),h(null)):h("Veuillez sélectionner au moins un service.")}}),2===e&&(0,d.jsx)(m,{selectedServices:r,totalDuration:k,selectedDate:p,setSelectedDate:v,reservations:g,availableSlots:j,setAvailableSlots:S,selectedSlot:b,setSelectedSlot:D,disabledDates:y,setDisabledDatesGlobal:w,onNextStep:()=>{b?(t(3),h(null)):h("Veuillez sélectionner un créneau horaire.")},onPrevStep:()=>{t(1),h(null)},error:c}),3===e&&(0,d.jsx)(x,{selectedDate:p,selectedSlot:b,selectedServices:r,totalDuration:k,onSubmit:async e=>{try{const s=await fetch("/wp-json/youbookpro/v1/reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json();throw new Error(e.message||"Erreur lors de la réservation")}const r=await s.json();return t(1),n([]),D(null),v(null),f([]),S([]),r}catch(e){throw console.error("Erreur lors de la réservation (dans BookingBlock) :",e),e}},onPrevStep:()=>{t(2),h(null)},error:c})]})}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,r.H)(e).render((0,d.jsx)(v,{}))}));const j=v;document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("youbookpro-booking-root");e&&(0,r.H)(e).render((0,d.jsx)(j,{}))}))})();